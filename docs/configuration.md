# Configuration

Configuration for this project is managed in several places:

1.  **Global Settings:** The `config/config.yml` file contains high-level settings for your homelab.
2.  **Terraform Variables:** The `infrastructure/proxmox/terraform.tfvars` file contains variables specific to the Proxmox infrastructure.
3.  **Ansible Inventory:** The Ansible inventory file tells Ansible which hosts to connect to.
4.  **Application Configuration:** The `config/apps/` directory contains `values.yaml` files for each application, which are used to configure the Helm charts deployed by ArgoCD.

## 1. Global Configuration (`config/config.yml`)

This file is the central place for all your high-level configuration. It is created when you run `make setup` by copying the example file from `config.example/config.yml`.

| Variable                   | Description                                                 |
| -------------------------- | ----------------------------------------------------------- |
| `common.domain_name`       | The domain name for your homelab (e.g., `homelab.local`).   |
| `common.timezone`          | The timezone for the servers (e.g., `Etc/UTC`).             |
| `common.load_balancer_ip`  | The IP address to be used by the Kubernetes load balancer.  |
| `common.proxmox_node`      | The name of the Proxmox node to deploy to.                  |
| `common.proxmox_template`  | The name of the cloud-init template to use for new VMs.     |
| `common.proxmox_service_bridge` | The Proxmox network bridge for the service network.    |
| `common.proxmox_service_vlan_tag` | The VLAN tag for the service network.               |
| `common.k3s_master_vm_id`  | The VM ID for the K3s master node.                          |
| `common.k3s_worker_vm_id_start` | The starting VM ID for the K3s worker nodes.            |
| `common.ldap_base_dn`      | The base DN for the LDAP server.                            |
| `secrets_to_generate`      | A list of secrets to be generated by the `secure-gen` role. |

## 2. Terraform Variables (`terraform.tfvars`)

This file holds the variables needed by Terraform to provision the infrastructure on Proxmox. The `make setup` command will prompt you for the required API credentials.

| Variable              | Description                                                                 |
| --------------------- | --------------------------------------------------------------------------- |
| `proxmox_api_url`     | The URL of your Proxmox API (e.g., `https://proxmox.example.com/api2/json`). |
| `pm_token_id`         | Your Proxmox API token ID.                                                  |
| `pm_token_secret`     | Your Proxmox API token secret.                                              |
| `proxmox_node`        | The name of the Proxmox node to deploy to.                                  |
| `proxmox_template`    | The name of the cloud-init template to use for the VMs.                     |
| `k3s_worker_count`    | The number of K3s worker nodes to create. Defaults to `1`.                  |
| `k3s_master_memory`   | The amount of memory (in MB) for the master VM. Defaults to `2048`.         |
| `k3s_master_cores`    | The number of CPU cores for the master VM. Defaults to `2`.                 |
| `k3s_worker_memory`   | The amount of memory (in MB) for the worker VMs. Defaults to `2048`.         |
| `k3s_worker_cores`    | The number of CPU cores for the worker VMs. Defaults to `22`.               |

## 3. Ansible Inventory

> ⚠️ **Important:** The automatic generation of the Ansible inventory file is currently **not implemented**.
>
> The Terraform configuration **does not** create this file. This means that after running `make terraform-apply`, the subsequent Ansible playbook will fail.
>
> **Workaround:**
>
> To make the Ansible playbook run, you must manually create the `ansible/inventory/inventory.auto.yml` file after your infrastructure is provisioned. You will need to get the IP addresses of the VMs created by Terraform from the Proxmox console.
>
> The file should look something like this:
>
> ```yaml
> # ansible/inventory/inventory.auto.yml
> all:
>   hosts:
>     k3s-master:
>       ansible_host: 192.168.1.10
>     k3s-worker-0:
>       ansible_host: 192.168.1.11
> ```
