# Configuration

Configuration for this project is stored in a private Git repository that you control. The `make setup-interactive` script will generate the initial configuration files and commit them to your repository.

The configuration is split into several types of files:

1.  **Global Settings:** A `config.yml` file contains high-level settings for your homelab.
2.  **Terraform Variables:** A `terraform.tfvars` file contains variables specific to the Proxmox infrastructure.
3.  **Ansible Inventory:** An Ansible inventory file tells Ansible which hosts to connect to.
4.  **Application Configuration:** An `apps/` directory contains `values.yaml` files for each application, which are used to configure the Helm charts deployed by ArgoCD.

During the setup process, the `homelabeazy` repository will create a symlink named `private` that points to your private configuration directory. This allows the tools in this repository to access your configuration.

## 1. Global Configuration (`config.yml`)

This file is the central place for all your high-level configuration. It is generated by the `homelab-importer` tool during the interactive setup.

| Variable                   | Description                                                 |
| -------------------------- | ----------------------------------------------------------- |
| `common.domain_name`       | The domain name for your homelab (e.g., `homelab.local`).   |
| `common.timezone`          | The timezone for the servers (e.g., `Etc/UTC`).             |
| `common.load_balancer_ip`  | The IP address to be used by the Kubernetes load balancer.  |
| `common.proxmox_node`      | The name of the Proxmox node to deploy to.                  |
| `common.proxmox_template`  | The name of the cloud-init template to use for new VMs.     |
| `common.proxmox_service_bridge` | The Proxmox network bridge for the service network.    |
| `common.proxmox_service_vlan_tag` | The VLAN tag for the service network.               |
| `common.k3s_master_vm_id`  | The VM ID for the K3s master node.                          |
| `common.k3s_worker_vm_id_start` | The starting VM ID for the K3s worker nodes.            |
| `common.ldap_base_dn`      | The base DN for the LDAP server.                            |
| `secrets_to_generate`      | A list of secrets to be generated by the `secure_gen` role. |

## 2. Terraform Variables (`terraform.tfvars`)

This file holds the variables needed by Terraform to provision the infrastructure on Proxmox. The `homelab-importer` tool will generate this file based on your existing Proxmox environment.

| Variable              | Description                                                                 |
| --------------------- | --------------------------------------------------------------------------- |
| `proxmox_api_url`     | The URL of your Proxmox API (e.g., `https://proxmox.example.com/api2/json`). |
| `pm_token_id`         | Your Proxmox API token ID.                                                  |
| `pm_token_secret`     | Your Proxmox API token secret.                                              |
| `proxmox_node`        | The name of the Proxmox node to deploy to.                                  |
| `proxmox_template`    | The name of the cloud-init template to use for the VMs.                     |
| `k3s_worker_count`    | The number of K3s worker nodes to create. Defaults to `1`.                  |
| `k3s_master_memory`   | The amount of memory (in MB) for the master VM. Defaults to `2048`.         |
| `k3s_master_cores`    | The number of CPU cores for the master VM. Defaults to `2`.                 |
| `k3s_worker_memory`   | The amount of memory (in MB) for the worker VMs. Defaults to `2048`.         |
| `k3s_worker_cores`    | The number of CPU cores for the worker VMs. Defaults to `22`.               |

## 3. Ansible Inventory

The Ansible inventory file (`ansible/inventory/inventory.auto.yml`) is generated automatically when you run the interactive setup. The script uses the output of `terraform output -json` to create the inventory file.
